
export class Analyzer {
    static detectSqlError(body: string): { detected: boolean; type?: string; snippet?: string } {
        const errors = [
            { type: 'MySQL', pattern: /SQL syntax.*MySQL|Warning.*mysql_|MySqlException/i },
            { type: 'PostgreSQL', pattern: /PostgreSQL.*ERROR|Warning.*pg_/i },
            { type: 'MSSQL', pattern: /Driver.* SQL[\-\_\ ]*Server|OLE DB.* SQL Server/i },
            { type: 'Oracle', pattern: /ORA-[0-9][0-9][0-9][0-9]|Oracle error/i },
        ];

        for (const err of errors) {
            const match = body.match(err.pattern);
            if (match) {
                return {
                    detected: true,
                    type: err.type,
                    snippet: match[0].substring(0, 100)
                };
            }
        }
        return { detected: false };
    }

    static detectReflectedXss(body: string, canary: string): boolean {
        return body.includes(canary);
    }

    static extractSensitiveInfo(body: string): string[] {
        const findings: string[] = [];
        const patterns = [
            { name: 'Email', regex: /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g },
            { name: 'API Key', regex: /api_key=[a-zA-Z0-9]{20,}/g },
        ];

        for (const p of patterns) {
            if (p.regex.test(body)) {
                findings.push(p.name);
            }
        }
        return findings;
    }
}
